<div id="discussion-container">
    <h1>Discussion</h1>

    <!-- Comment Form with HTMX -->
    <div id="comment-form">
        <h2>Post a Comment</h2>
        {% if error %}
        <div class="error">{{ error }}</div>
        {% endif %}
        <form hx-post="/discussion" hx-target="#discussion-container" hx-swap="outerHTML">
            <div>
                <label for="username">Your Name:</label>
                <input type="text" id="username" name="username" required>
            </div>
            <div>
                <label for="body">Comment:</label>
                <textarea id="body" name="body" rows="4" required></textarea>
            </div>
            <button type="submit">Post Comment</button>
        </form>
    </div>

    <!-- Comments List -->
    <div id="comments-list">
        <h2>Comments (Sorted by Votes)</h2>
        {% if comments %}
            {% for comment in comments %}
            <div id="comment-{{ comment.id }}" class="comment">
                <div class="comment-header">
                    <strong>{{ comment.username }}</strong>
                    <span class="comment-timestamp">{{ comment.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                </div>
                <div class="comment-body">
                    {{ comment.body }}
                </div>
                <div class="comment-actions">
                    <div class="vote-buttons">
                        <button 
                            class="upvote-button"
                            hx-post="/comment/{{ comment.id }}/upvote" 
                            hx-target="#comment-{{ comment.id }}"
                            hx-swap="outerHTML">
                            üëç Upvote
                        </button>
                        <button 
                            class="downvote-button"
                            hx-post="/comment/{{ comment.id }}/downvote" 
                            hx-target="#comment-{{ comment.id }}"
                            hx-swap="outerHTML">
                            üëé Downvote
                        </button>
                    </div>
                    <div class="vote-count">
                        <span title="Upvotes: {{ comment.upvotes }}, Downvotes: {{ comment.downvotes }}">
                            Score: <strong>{{ comment.vote_score }}</strong>
                        </span>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p>No comments yet. Be the first to comment!</p>
        {% endif %}
    </div>
</div>
