{% for c, highlighted in contributions %}
<div class="contribution-cell expandable-cell">
    <div class="cell-content">
        <div class="cell-preview">
            <div class="contribution-id">Contribution n&#186; {% if highlighted %}{{ highlighted.id }}{% else %}{{ c.id
                }}{% endif %}
            </div>
            <div class="contribution-author">Auteur {% if highlighted %}{{ highlighted.contributor|truncate(50) }}{%
                else %}{{ c.contributor|truncate(20) }}{% endif %}
            </div>
            <div class="contribution-body">{% if highlighted %}{{ highlighted.body|truncate(100) }}{% else %}{{
                c.body|truncate(50) }}{% endif %}
            </div>
            <div class="contribution-date">{{ c.time.strftime('Le %d/%m/%Y à %Hh%M') }}</div>
        </div>
        <div class="cell-full">
            <div class="contribution-id">Contribution n&#186; {% if highlighted %}{{ highlighted.id }}{% else %}{{ c.id
                }}{% endif %}
            </div>
            <div class="contribution-author">Auteur {% if highlighted %}{{ highlighted.contributor }}{% else %}{{
                c.contributor }}{% endif %}
            </div>
            <div class="contribution-body">{% if highlighted %}{{ highlighted.body }}{% else %}{{ c.body }}{% endif %}
            </div>
            <div class="contribution-date">{{ c.time.strftime('Le %d/%m/%Y à %Hh%M') }}</div>
        </div>
        <button class="toggle-expand" onclick="toggleExpand(this)">+</button>
    </div>
</div>
{% if loop.last and has_more %}
<div class="loading-cell"
     hx-get="{{ url_for('get_contributions_data', page=(page or 1) + 1, search=search_query) }}"
     hx-trigger="revealed"
     hx-swap="outerHTML"
     hx-target="this">
    Chargement des contributions...
</div>
{% endif %}
{% endfor %}

{% if not contributions %}
<div class="no-results">Fin de la liste de résultats.</div>
{% endif %}


<script>
    function toggleExpand(button) {
        const cellContent = button.parentElement;
        const isExpanded = cellContent.classList.contains('expanded');

        if (isExpanded) {
            cellContent.classList.remove('expanded');
            button.textContent = '+';
        } else {
            cellContent.classList.add('expanded');
            button.textContent = '-';
        }
    }
</script>
