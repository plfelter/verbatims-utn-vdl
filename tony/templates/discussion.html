{% extends "base.html" %}

{% block title %}Discussion - Tony App{% endblock %}

{% block content %}
    <div id="discussion-container">
        <h1>Discussion</h1>

        <!-- Comment Form with HTMX -->
        <div id="comment-form">
            <h2>Post a Comment</h2>
            {% if error %}
            <div class="error">{{ error }}</div>
            {% endif %}
            <form hx-post="/discussion" hx-target="#discussion-container" hx-swap="outerHTML">
                <div>
                    <label for="username">Your Name:</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div>
                    <label for="body">Comment:</label>
                    <textarea id="body" name="body" rows="4" style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;" required></textarea>
                </div>
                <button type="submit">Post Comment</button>
            </form>
        </div>

        <!-- Comments List -->
        <div id="comments-list">
            <h2>Comments (Sorted by Votes)</h2>
            {% if comments %}
                {% for comment in comments %}
                <div id="comment-{{ comment.id }}" class="comment" style="border: 1px solid #ddd; border-radius: 5px; padding: 15px; margin-bottom: 15px;">
                    <div class="comment-header" style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <strong>{{ comment.username }}</strong>
                        <span style="color: #777;">{{ comment.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                    </div>
                    <div class="comment-body" style="margin-bottom: 10px;">
                        {{ comment.body }}
                    </div>
                    <div class="comment-actions" style="display: flex; align-items: center; gap: 10px;">
                        <div class="vote-buttons">
                            <button 
                                hx-post="/comment/{{ comment.id }}/upvote" 
                                hx-target="#comment-{{ comment.id }}"
                                hx-swap="outerHTML"
                                style="background-color: #4CAF50; padding: 5px 10px; font-size: 12px;">
                                üëç Upvote
                            </button>
                            <button 
                                hx-post="/comment/{{ comment.id }}/downvote" 
                                hx-target="#comment-{{ comment.id }}"
                                hx-swap="outerHTML"
                                style="background-color: #666666; padding: 5px 10px; font-size: 12px;">
                                üëé Downvote
                            </button>
                        </div>
                        <div class="vote-count" style="margin-left: 10px;">
                            <span title="Upvotes: {{ comment.upvotes }}, Downvotes: {{ comment.downvotes }}">
                                Score: <strong>{{ comment.vote_score }}</strong>
                            </span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p>No comments yet. Be the first to comment!</p>
            {% endif %}
        </div>
    </div>
{% endblock %}
